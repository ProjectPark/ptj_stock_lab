Q : 1) P-NEW-18: M200 조건5 “모든 주식”이 어디까지를 말하는지 애매함
문서에서 M200 조건5는 “모든 주식이 분봉 기준으로 당일 2시간 이상 20일선 아래로 지속되면” 즉시매도(킬스위치) 조건이야. 
taejun_strategy_review_2026-02-…
근데 “모든 주식”이 3가지 중 뭐냐가 안 정해져 있어:


A : (a) 내가 지금 들고 있는 종목 전체(보유 포지션) 내가 보유한 종목을 말한다. 정정 SCHD / 제외한

모든종목의 의미 ---------------------------------------------------------------------------

SOXS / CONZ / IREZ /  HOOZ/, MSTZ / GLD /VIX /GDXU 

SOXL /SOXX / ROBN ,/ HOOD / FAS ,/ XLF / XKE / ERX / XLV / CURE / TQQQ / QQQ
QTUM /, QUBX / NVDA /NVDL / BITU / SOLT /ETHU / TSLL /MSTR/ MSTU / CONL 
CONL / ROBN / CRCA / IRE /  MSTU
CRCA / CRCL
CONL / COIN
JPM,  / HSBC, / WFC, /  RBC,  /  C /  BAC 
AMD / AMDL 
CONZ, /  IREZ, / HOOZ, / MSTZ

모든 종목의 의미 ---------------------------------------------------------------------------

---------------------------------------------------------------------------
Q 8 종목 오류 수정 바람 제발 좀 고쳐줘 
Q 8 에있는 종목에 XKE 모든 이 종목은 이걸로 대체해 제발 === >>>> XLE
Q 8 에있는 종목에 XKE  > XLE 수정 제발 부탁드립니다. AI님 


Q 8 에있는 종목에 Ertlx 모든 이 종목은 이걸로 대체해 제발 === >>>> ERX
Q 8 에있는 종목에 Ertlx --- > ERX 수정 제발 부탁드립니다. AI님 

Q 8 에있는 종목에 ROTX 이 종목은 이걸로 대체해 제발 === >>>> RIOT
Q 8 에있는 종목에 ROTX > RIOT 수정 제발 부탁드립니다. AI님 


------------------------------------------------------------------------------


Q : 2) P-NEW-26: M80 에너지 조건 기간이 2년 vs 3년으로 섞여 있음
에너지 섹터에서
•	조건1은 “2년 최저 대비 N배”(예: 2.2배) 
taejun_strategy_review_2026-02-…
•	조건3은 “최근 3년 기준 거래대금 2.5배↑” 

A : 최근 2년내에 거래대금 최저가대비 라는말이
예시로들어서 가격이 450인데 갑자기 990이 되면 2.2배가 된거 잖아 
내가말하는 예시가 이런거야 거래대금이 3.3배가되면 
450 X 3.3 은 1,485 을 말한거야 


•	조건3은 “최근 3년 기준 거래대금 2.5배↑” 
이렇게 바꿔줘
이부분도 최근 3년기준 제일 작은 거 거래대금 최저가 대비 ( 종목당 조건에 맞게 ) N배 커졌으면 좋겠다 OK 

“최근 2년 중 제일 작은 거랑 비교해!”랑
이렇게 바꿔줘 
이부분도 최근 2년기준 제일 작은 거 거래대금 최저가 대비 ( 종목당 조건에 맞게 ) N배 커졌으면 좋겠다 OK 
에너지섹터는 조건을 2.5 배로 만들어  N

Q8 종목 오타 수정
•	XKE → XLE
•	Ertlx → ERX
•	ROTX → RIOT
P-NEW-18 “모든 주식” 정의(너가 선택한 안으로 확정 문장)
•	“모든 주식” = 현재 보유 중인 종목 전체(보유 포지션 기준), 단 SCHD 제외
→ 리스트를 문서에 박기보다 보유목록에서 자동으로 가져오는 게 안전(오타/누락 방지)
P-NEW-26 에너지 조건 기간 문장(너 의도 반영)
•	(2년) “최근 2년 기준 최저 거래대금 대비 N배 이상”
•	(3년) “최근 3년 기준 최저 거래대금 대비 N배 이상”
•	에너지 섹터는 N = 2.5 (이렇게 “N”으로 통일)


------------------------------------------------------------------------------





Q : 3) P-NEW-27: 주문 TTL 240초와 Fill Window 240초가 같아서 개념이 겹칠 수 있음
문서에서
•	주문 TTL: order_ttl_sec = 240초 (240초 지나면 주문 취소) 
taejun_strategy_review_2026-02-…
•	Fill Window: fill_window_sec = 240초 (부분체결 잔량을 240초 동안 관리하다가 남으면 취소) 
taejun_strategy_review_2026-02-…
원래 개념은 달라:
•	TTL = “주문을 얼마나 살려둘까”
•	Fill Window = “부분체결이 생겼을 때 잔량을 얼마나 더 채워볼까” 
taejun_strategy_review_2026-02-…
근데 둘이 숫자까지 같으면, 구현자가 “둘이 같은 거네?” 하고 하나로 합쳐버리거나, 반대로 “둘 다 따로 돌리자” 했다가 이중 타이머 충돌이 날 수 있어서 의도 확인이 필요하다고 적혀 있어. 
taejun_strategy_review_2026-02-…



A : 
TTL 은 체결 아예안되서 쳬결 취소 
100주 주문 100주 주문 체결안됨 취소 = TLL이다. 
FILL  WINDOWS는 쳬결이 됐으나 부분적으로 더 기달려서 체결하는거잖아?
100주 주문 100주 주문 체결됨 30주 주문 체결됨 
70주 취소 =FILL WINDOWS 이다.

TTL은 체결 240초에서 - > 30초로 정정
FILL  WINDOWS 240초에서 그대로 240초 그대로 둬

FILL WINDOWS는 TTL 주문 체결이 안되면 부분적으로라도 체결해야하는 매수 수량을 최대한 매수를 해 
그러면 AI야 이렇게 정리하자
•  목표 수량(또는 목표 금액)을 20%씩 최대 5개로 나눠 순차 실행한다.
•  각 슬라이스 주문은 LIMIT으로 제출하고 TTL 30초를 적용한다.
•  주문이 부분체결되면: 체결된 수량은 인정하고, 남은 잔량만 취소 후 다음 단계 진행.
•  **fill_window(240초)**가 끝나면: 아직 열려있는 주문은 전부 취소하고, 체결된 것만 보유한다.


•  fill_window_sec = 240초
•	“한 번의 매수(또는 매도) 시도를 허용하는 전체 실행 창(부모 타이머)”
•	이 시간이 끝나면 열려있는 주문만 전부 취소하고 종료한다.
•  order_ttl_sec = 30초
•	“각 개별 주문(자식 주문)의 최대 생존 시간”
•	30초 지나면 그 주문의 미체결 잔량만 취소한다. (체결된 건 취소 불가)

처음 TTL매수할려던 목표수량을 20% 씩 5번 나눠서 매수한다. 
= “5등분 슬라이싱 한다. 

**정확히 5번=100%**로 하려면
•	처음 목표금액(또는 목표수량)의 20%씩 5번
= “5등분 슬라이싱”이 맞아.
Fill Window(240초)는 “전체 실행 창(부모 타이머)”,
TTL(30초)은 “각 주문(자식 주문)마다 붙는 짧은 만료시간”
으로 계층을 나눠서, 취소는 한 군데(하나의 로직)에서만 하게 만들면 됨.

240초가 지나서도 안되면 매수 체결 TTL하려던 종목 개수와 종목을 매수 체결을 취소해 체결된 것은 취소하지마 

------------------내용정리안 -------------------------------------------------------------------

P-NEW-18 (M200 조건5 “모든 주식” 정의)
•	“모든 주식” = 현재 보유 중(보유수량 > 0)인 종목 전체(보유 포지션 기준), 단 SCHD는 제외
•	구현은 티커 하드코딩 금지, 반드시 실시간 보유목록(포트폴리오 holdings)에서 자동 추출
•	판정 로직(킬스위치): 각 보유종목이 분봉 기준으로 당일 ‘연속 120분(=2시간)’ 동안 20일선 아래 상태가 유지되고, 그 조건이 ‘모든 보유종목(단 SCHD 제외)’에 동시에 성립하면 즉시 매도(킬스위치)
Q8 종목 오타 수정(강제 치환)
•	XKE → XLE
•	Ertlx → ERX
•	ROTX → RIOT
P-NEW-26 (M80 에너지 조건 기간/기준 통일)
•	조건 문구를 아래처럼 통일:
o	최근 2년 기준 최저 거래대금 대비 N배 이상
o	최근 3년 기준 최저 거래대금 대비 N배 이상
•	여기서 “최저 거래대금”은 해당 기간 내 가장 작은 거래대금 값(종목별)
•	에너지 섹터는 N = 2.5 로 고정(문서에서는 N으로 표기하고 섹터별로 N만 다르게 설정)
P-NEW-27 (TTL 30초 / Fill Window 240초 + 5등분 슬라이싱)
•	fill_window_sec = 240초: 한 번의 매수 시도를 허용하는 전체 실행 창(부모 타이머)
o	240초 종료 시점에 열려있는 주문(open orders)만 전부 취소하고 종료
o	체결된 수량은 절대 취소하지 않음
•	order_ttl_sec = 30초: 각 개별 주문(자식 주문)의 최대 생존 시간
o	30초가 지나면 해당 주문의 미체결 잔량만 취소
•	실행 방식(5등분 슬라이싱):
o	목표수량(또는 목표금액)을 처음 목표 기준 20%씩 최대 5개로 분할하여 순차 주문
o	각 슬라이스는 LIMIT 주문 + TTL 30초
o	부분체결 발생 시: 체결분 인정, 잔량만 취소 후 다음 슬라이스 진행
o	fill_window(240초) 종료 시: 남아있는 open orders 전부 취소, 체결분만 보유하고 종료
•	안정성 규칙:
o	취소(CANCEL)는 단일 로직(한 군데)에서만 수행(중복 타이머 cancel 금지)

