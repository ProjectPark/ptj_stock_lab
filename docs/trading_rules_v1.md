# PTJ 매매법 — 알고리즘 규칙 문서

> 분석 기간: 2025.02.19 ~ 2026.02.12 | 실거래 953건 | 라운드트립 748건

---

## 전체 매매 흐름

```
장 시작 (09:30 ET)
  │
  ├─ [R1] 금 시황 체크 (첫 30분)
  │    ├─ GLD 양전 → 당일 매매 금지 (현금 보유)
  │    └─ GLD 음전/보합 → 매매 진행
  │
  ├─ [R2] 쌍둥이 페어 갭 체크 (5분봉 순회)
  │    ├─ 갭 ≥ 1.5% → 후행 종목 매수
  │    ├─ 갭 ≤ 0.3% → 후행 종목 매도 (수렴 = 수익 실현)
  │    └─ 그 외 → 관망
  │
  ├─ [R3] 조건부 매매 체크
  │    ├─ ETHU + XXRP + SOLT 모두 양전 → COIN 매수
  │    └─ 하나라도 음전 → 조건 미충족 (매수 안 함)
  │
  ├─ [R4] 손절 체크 (매 5분봉)
  │    ├─ 보유 종목 -3% 이하 → 즉시 매도 (손절)
  │    └─ -3% 이하 종목 추가 매수 금지
  │
  ├─ [R5] 하락장 방어 체크
  │    ├─ SPY < 0% AND QQQ < 0% → 비방어주 매수 금지
  │    │    ├─ GLD 양전 → 금 2x ETF 매수
  │    │    └─ GLD 음전 → 방어주(HIMZ/BRKU/BABX) 매수
  │    └─ 시장 정상 → 일반 매매 진행
  │
  └─ 장 마감 (16:00 ET)
       └─ 전 포지션 청산 (데이트레이드 원칙)
```

---

## R1: 금 시황 체크

### 규칙

| 항목 | 내용 |
|------|------|
| **대상** | GLD (SPDR Gold Shares ETF) |
| **판단 기준** | 전일 종가 대비 등락률 |
| **현재 임계값** | GLD > 0% (양전이면 매매 금지) |
| **적용 시점** | 장 시작 후 30분 (09:30~10:00 ET) |
| **효과** | 당일 전체 매매 중단 |

### 로직

```python
# 첫 30분(5분봉 6개) 동안 GLD 변화율 계산
gold_change = (gold_30min_close - prev_day_close) / prev_day_close * 100
if gold_change > 0:
    return "매매 금지"  # 당일 전체 스킵
```

### 근거

금 가격 상승 = 시장 불안 심리 = 레버리지 ETF에 불리한 환경. 금이 오르는 날은 위험자산이 하락하는 경향이 있으므로 매매를 쉰다.

### 실제 매매 성과 (1년간)

| 구분 | 건수 | 순손익 | 평균수익률 | 승률 |
|------|------|--------|-----------|------|
| **R1 위반 (금 양전인데 매수)** | 487건 | **-$134,328** | +7.84% | 57.3% |
| **R1 준수 (금 음전일 매수)** | 261건 | -$62,495 | +7.89% | 58.2% |

**분석**: 금 양전일 매수 487건이 -$134K 손실. 이 규칙을 **완벽히 지켰으면 $134K 덜 잃었을 것**. 전체 손실(-$197K)의 68%가 R1 위반에서 발생.

### 파라미터 최적화

| 임계값 | 차단 거래 | 차단 PnL | 순개선 효과 |
|--------|----------|---------|-----------|
| GLD > 0% (현재) | 487건 | -$134,328 | +$134,328 |
| GLD > 0.25% | 437건 | -$123,260 | +$123,260 |
| GLD > 0.5% | 305건 | -$119,603 | +$119,603 |
| GLD > 1.0% | 145건 | -$52,762 | +$52,762 |
| GLD > 2.0% | 62건 | +$1,292 | -$1,292 |

**결론**: 현재 0% 임계값이 최적. 기준을 올리면 개선 효과가 감소함. GLD > 2.0%까지 올리면 오히려 마이너스.

### 실전 적용 가이드

```
1. 장 시작 전 GLD 프리마켓 확인
2. 09:30~10:00 GLD 변동 모니터링
3. GLD가 양전(+0.01% 이상)이면:
   → 신규 매수 전면 중단
   → 기존 보유 종목은 손절 규칙(R4)만 적용
   → "오늘은 쉬는 날" 마인드셋
4. GLD가 음전이면:
   → R2~R5 규칙에 따라 정상 매매
```

---

## R2: 쌍둥이 페어 갭 매매

### 규칙

| 항목 | 내용 |
|------|------|
| **매수 조건** | lead - follow 갭 ≥ 1.5% → follow 매수 |
| **매도 조건** | lead - follow 갭 ≤ 0.3% → follow 매도 (수렴) |
| **적용 대상** | 3개 페어 (아래 표) |
| **체크 주기** | 5분봉마다 |

### 페어 구성

| 페어 | 선행(Lead) | 후행(Follow) | 매매 대상 |
|------|-----------|-------------|----------|
| **코인** | BITU (비트코인 2x) | MSTU (스트래티지 2x) | MSTU |
| **은행** | ROBN (로빈후드 2x) | CONL (코인베이스 2x) | CONL |
| **반도체** | NVDL (엔비디아 2x) | AMDL (AMD 2x) | AMDL |

### 로직

```python
gap = lead_change_pct - follow_change_pct

if abs(gap) >= 1.5:       # 갭 확대 → 후행 종목이 저평가
    signal = "ENTRY"       # 후행 종목 매수
elif abs(gap) <= 0.3:      # 갭 수렴 → 페어 정상화
    signal = "SELL"        # 보유 중이면 매도 (수익 실현)
else:
    signal = "HOLD"        # 관망
```

### 근거

같은 섹터의 2x 레버리지 ETF는 장기적으로 유사하게 움직인다. 일시적 갭이 벌어지면 뒤처진 종목을 매수하고, 갭이 좁혀지면 수익을 실현한다 (평균 회귀 전략).

### 실제 매매 성과

| 구분 | 건수 | 순손익 | 평균수익률 | 승률 |
|------|------|--------|-----------|------|
| **R2 위반** | 171건 | **-$95,613** | +1.67% | 58.5% |
| **R2 준수** | 577건 | -$101,209 | +9.69% | 57.4% |

**분석**: 위반 거래의 평균 수익률(+1.67%)이 준수(+9.69%)보다 현저히 낮음. 갭 기준 없이 매매하면 수익성이 크게 떨어짐.

### 위반 유형 상세

| 위반 유형 | 예시 | 문제점 |
|----------|------|--------|
| **갭 미달 매수** | 갭 0.8%인데 매수 | 충분한 갭 없이 진입 → 수렴 여지 부족 |
| **갭 큰 상태 매도** | 갭 10%인데 매도 | 아직 수렴 안 됐는데 조기 매도 → 수익 미실현 |

### 실전 적용 가이드

```
1. 대시보드에서 3개 페어의 갭(%) 실시간 확인
2. 매수 시:
   → 반드시 갭 ≥ 1.5% 확인 후 진입
   → 갭이 1.0~1.4%이면 "좀 더 기다리자" (참을성)
3. 매도 시:
   → 갭 ≤ 0.3%까지 기다린 후 매도 (조급한 매도 금지)
   → 갭이 0.5~1.0%이면 아직 보유 (수렴 기다림)
4. 예외:
   → R4 손절(-3%)에 걸리면 갭 상관없이 즉시 매도
   → 장 마감 시 강제 청산
```

---

## R3: 조건부 매매 (COIN)

### 규칙

| 항목 | 내용 |
|------|------|
| **트리거 종목** | ETHU (이더리움 2x), XXRP (리플 2x), SOLT (솔라나 2x) |
| **매수 대상** | COIN (코인베이스) |
| **매수 조건** | 3개 트리거 **모두 양전** (+0% 초과) |
| **체크 주기** | 5분봉마다 |

### 로직

```python
ethu_positive = ETHU_change > 0
xxrp_positive = XXRP_change > 0
solt_positive = SOLT_change > 0

if ethu_positive and xxrp_positive and solt_positive:
    buy("COIN")  # 크립토 전체 강세 → 코인베이스 매수
```

### 근거

이더리움, 리플, 솔라나가 동시에 오르면 크립토 시장 전체가 강세. 이 때 크립토 거래소인 코인베이스(COIN)는 거래량 증가로 수혜를 받는다.

### 실제 매매 성과

| 구분 | 건수 | 순손익 | 승률 |
|------|------|--------|------|
| **R3 위반** | 0건 | $0 | - |
| **R3 준수** | 748건 | -$196,822 | 57.6% |

**분석**: 1년간 R3 위반 0건. **가장 잘 지킨 규칙**. 조건이 명확하고 (3개 모두 양전) 주관적 판단 여지가 없어서 준수가 쉬웠던 것으로 보임.

### 실전 적용 가이드

```
1. COIN 매수를 고려할 때:
   → ETHU, XXRP, SOLT 3개를 반드시 확인
   → 하나라도 음전이면 매수 금지
2. 이 규칙은 현재 완벽히 지키고 있으므로 유지
3. 확장 고려: 트리거 임계값을 0% → +1%로 올려
   더 강한 확신 시에만 매수하는 것도 검토 가능
```

---

## R4: 손절 체크

### 규칙

| 항목 | 내용 |
|------|------|
| **대상** | 모든 보유 종목 |
| **현재 임계값** | 전일 종가 대비 -3% 이하 |
| **적용 1** | -3% 이하 보유 종목 → 즉시 매도 (손절) |
| **적용 2** | -3% 이하 종목 → 추가 매수 금지 (물타기 금지) |
| **체크 주기** | 5분봉마다 (시그널 체크보다 먼저) |

### 로직

```python
# 보유 종목 손절 체크
for ticker in positions:
    pnl_pct = (current_price - entry_price) / entry_price * 100
    if pnl_pct <= -3.0:
        sell(ticker, reason="stop_loss")  # 즉시 매도

# 신규 매수 시 체크
if ticker_daily_change <= -3.0:
    block_buy(ticker)  # 추가 매수 금지
```

### 근거

레버리지 ETF는 하락 시 손실이 배로 확대되므로 빠른 손절이 필수. -3%에서 끊지 않으면 -10%, -20%까지 빠질 수 있다. 물타기(추가 매수로 평균단가 낮추기)는 손실을 키울 위험이 크다.

### 실제 매매 성과

| 구분 | 건수 | 순손익 | 평균수익률 | 승률 |
|------|------|--------|-----------|------|
| **R4 위반 (물타기)** | 238건 | **-$96,600** | +9.82% | 68.1% |
| **R4 준수** | 510건 | -$100,223 | +6.94% | 52.7% |

**분석**: 물타기 거래가 승률 68.1%로 높아 보이지만, 실패 시 손실 폭이 커서 총 PnL은 -$96K. 승률이 높다고 좋은 전략이 아님 (소수의 큰 손실이 다수의 작은 수익을 삼킴).

### 파라미터 최적화

| 임계값 | 차단 거래 | 차단 PnL | 순개선 효과 |
|--------|----------|---------|-----------|
| 종목 ≤ -1% | 353건 | -$97,815 | +$97,815 |
| 종목 ≤ -2% | 293건 | -$98,835 | +$98,835 |
| **종목 ≤ -3% (현재)** | **238건** | **-$96,600** | **+$96,600** |
| **종목 ≤ -4% (최적)** | **213건** | **-$100,486** | **+$100,486** |
| 종목 ≤ -5% | 181건 | -$25,885 | +$25,885 |
| 종목 ≤ -10% | 77건 | -$9,919 | +$9,919 |

**결론**: -4% 임계값이 최적 (+$100K 개선). -3%~-4% 구간에서 물타기가 가장 큰 손실을 만들었음.

### 실전 적용 가이드

```
1. 보유 종목이 매수가 대비 -3% 이하:
   → 즉시 매도 (미련 없이)
   → "평균단가를 낮추자"는 유혹 금지
2. 당일 등락률이 -3% 이하인 종목:
   → 신규 매수 금지
   → "바닥이니까 싸게 사자"는 함정
3. 심리적 팁:
   → 손절은 "손해"가 아니라 "보험"
   → 물타기 충동이 들면 10분 기다리기
4. 제안: -4%로 소폭 조정 시 +$4K 추가 개선 가능
```

---

## R5: 하락장 방어 매매

### 규칙

| 항목 | 내용 |
|------|------|
| **시장 하락 판정** | SPY < 0% **AND** QQQ < 0% (동반 하락) |
| **GLD 양전 시** | 금 2x ETF 매수 검토 |
| **GLD 음전 시** | 방어주 매수 (HIMZ, BRKU, BABX) |
| **핵심** | 시장 하락일에는 **비방어주 매수 금지** |

### 방어주 목록

| 티커 | 종목 | 특성 |
|------|------|------|
| HIMZ | 힘스앤허스 2x | 헬스케어 (경기 방어) |
| BRKU | 버크셔 2x | 가치투자 (하락장 방어) |
| BABX | 알리바바 2x | 중국 테크 (미국 시장 역상관) |

### 로직

```python
spy_change = SPY_change_pct
qqq_change = QQQ_change_pct
gld_change = GLD_change_pct

market_down = (spy_change < 0) and (qqq_change < 0)

if market_down and gld_change > 0:
    buy("금 2x ETF")         # 안전자산 + 레버리지
elif market_down:
    buy(["HIMZ", "BRKU", "BABX"])  # 방어주
    block_buy(["MSTU", "CONL", "AMDL", ...])  # 공격적 종목 매수 금지
else:
    normal_trading()          # R2~R4 정상 적용
```

### 근거

SPY(S&P 500)와 QQQ(나스닥)가 동시에 하락하면 시장 전체가 약세. 이런 날에 레버리지 ETF(2x/3x)를 매수하면 하락이 증폭된다. 대신 방어적 종목으로 전환하여 손실을 제한한다.

### 실제 매매 성과

| 구분 | 건수 | 순손익 | 평균수익률 | 승률 |
|------|------|--------|-----------|------|
| **R5 위반 (하락장에 비방어주 매수)** | 280건 | **-$28,044** | +14.11% | 73.2% |
| **R5 준수** | 468건 | -$168,779 | +4.12% | 48.3% |

**분석**: R5 위반의 승률(73.2%)과 평균수익률(+14.11%)이 높아 보임. 이는 시장이 일시 하락 후 반등하면 레버리지 ETF가 큰 수익을 내기 때문. 하지만 반등하지 않을 때의 손실이 크므로 총 PnL은 마이너스.

### 파라미터 최적화

| 임계값 | 차단 거래 | 차단 PnL | 순개선 효과 |
|--------|----------|---------|-----------|
| **SPY&QQQ < 0% (현재)** | **281건** | **-$28,043** | **+$28,043** |
| SPY&QQQ < -0.25% | 208건 | -$13,628 | +$13,628 |
| SPY&QQQ < -0.5% | 161건 | +$3,234 | -$3,234 |
| SPY&QQQ < -1.0% | 93건 | +$1,439 | -$1,439 |

**결론**: 현재 0% 임계값이 최적. -0.5% 이상 하락에서는 오히려 수익 기회를 놓치게 됨. 미세 하락(-0.1%)에서는 매수 차단이 유효하지만, 강한 하락(-0.5%+)에서는 반등 매수가 수익을 냄.

### 실전 적용 가이드

```
1. 장 시작 후 SPY와 QQQ 동시 확인
2. 둘 다 음전이면:
   → MSTU, CONL, AMDL 등 공격적 종목 매수 금지
   → 방어주(HIMZ/BRKU/BABX) 또는 금 ETF로 전환
   → 기존 보유 종목은 R4 손절 규칙만 적용
3. SPY 또는 QQQ 중 하나만 음전이면:
   → R5 적용 안 함, 정상 매매
4. 장중 SPY/QQQ가 양전으로 전환되면:
   → R5 해제, 정상 매매 재개 가능
```

---

## 규칙 간 우선순위

```
R1 (금 시황)  ←── 최우선. 양전이면 나머지 규칙 무관하게 전면 중단
  │
  ├─ R5 (하락장) ←── R1 통과 후, 시장 전체 상태 체크
  │    │
  │    ├─ R4 (손절) ←── 항상 적용 (다른 규칙보다 우선)
  │    │
  │    ├─ R2 (쌍둥이 갭) ←── 정상 시장에서 메인 매매
  │    │
  │    └─ R3 (조건부) ←── COIN 매수 시에만 적용
  │
  └─ R4 (손절) ←── R1으로 스킵해도 기존 보유 종목 손절은 실행
```

---

## 종합 성과 분석

### 시나리오 비교

| 시나리오 | 거래 | 승률 | 순손익 | 수익률 |
|---------|------|------|--------|--------|
| **A. 실제 매매** | **748건** | **70.3%** | **-$196,822** | **-11.85%** |
| C. 규칙 완벽 준수만 | 136건 | 80.7% | -$14,628 | -3.36% |
| E. R1만 준수 | 331건 | 79.8% | -$40,761 | -5.31% |
| E. R4만 준수 | 583건 | 71.4% | -$65,239 | -4.68% |
| E. R2만 준수 | 618건 | 71.9% | -$88,689 | -7.43% |
| E. R5만 준수 | 511건 | 63.8% | -$135,216 | -9.94% |

### 규칙 위반 비용 순위

| 순위 | 규칙 | 위반 PnL | 비중 |
|------|------|---------|------|
| 1 | R1 금 시황 | -$134,328 | 68% |
| 2 | R4 손절 | -$96,600 | 49% |
| 3 | R2 쌍둥이 갭 | -$95,613 | 49% |
| 4 | R5 하락장 | -$28,044 | 14% |

### 복합 위반

| 항목 | 값 |
|------|-----|
| 2개 이상 동시 위반 | 330건 |
| 복합 위반 PnL | -$95,290 |
| 전체 손실 중 비중 | 48% |

---

## 알고리즘 개선 제안

### 1. R1: 현재 임계값 유지 + 엄격 적용

- 현재 GLD > 0% 기준이 데이터상 최적
- 개선 포인트: **규칙 자체가 아니라 준수율(63.3%)을 올리는 것이 핵심**
- 제안: 대시보드에 GLD 양전 시 빨간 경고 배너 + 매수 버튼 비활성화

### 2. R2: 매도 임계값 0.3% → 0.5% 완화 검토

- 갭 0.3% 이하까지 기다리면 수렴 기회를 놓치는 경우 있음
- 위반 중 수익 거래 100건 / 171건 (58%) → 기준이 과도하게 엄격할 수 있음
- 제안: 매도 임계값을 0.5%로 완화하여 조기 수익 실현 허용

### 3. R4: 손절 -3% → -4%로 소폭 조정

- -4% 기준이 +$100K로 가장 큰 개선 효과
- -3%~-4% 구간의 물타기가 가장 큰 손실 원인
- 제안: -4%로 조정 (약간의 유연성 확보, 과매도 반등 기회 포착)

### 4. R5: 현재 0% 유지 + 단계별 방어 도입

- 현재 0% 기준이 최적이지만, 시장 하락 강도에 따른 차등 대응 검토
- 제안:
  - SPY/QQQ -0.25% 미만: 신규 매수 50% 축소
  - SPY/QQQ -0.5% 미만: 신규 매수 전면 중단
  - SPY/QQQ -1.0% 미만: 보유 포지션도 축소

### 5. 신규 규칙: 복합 위반 차단

- 2개 이상 규칙 동시 위반 330건이 -$95K 손실
- 제안: **R6 복합 위반 차단** — 2개 이상 규칙 위반 시 매매 강력 금지

### 6. 신규 규칙: 거래 빈도 제한

- 2025.06~07월 월 240~280건 폭증 → 위반+손실 집중
- 제안: **R7 일일 매수 횟수 제한** — 최대 5회/일

---

## 부록: 종목 레지스트리

| 티커 | 종목명 | 카테고리 | 적용 규칙 |
|------|-------|---------|----------|
| GLD | 금 ETF | 시황 판단 | R1 기준 |
| BITU | 비트코인 2x | 쌍둥이 (코인 Lead) | R2 기준 |
| MSTU | 스트래티지 2x | 쌍둥이 (코인 Follow) | R2 매매 대상 |
| ROBN | 로빈후드 2x | 쌍둥이 (은행 Lead) | R2 기준 |
| CONL | 코인베이스 2x | 쌍둥이 (은행 Follow) | R2 매매 대상 |
| NVDL | 엔비디아 2x | 쌍둥이 (반도체 Lead) | R2 기준 |
| AMDL | AMD 2x | 쌍둥이 (반도체 Follow) | R2 매매 대상 |
| ETHU | 이더리움 2x | 조건부 트리거 | R3 트리거 |
| XXRP | 리플 2x | 조건부 트리거 | R3 트리거 |
| SOLT | 솔라나 2x | 조건부 트리거 | R3 트리거 |
| COIN | 코인베이스 | 조건부 매수 대상 | R3 매매 대상 |
| HIMZ | 힘스앤허스 2x | 방어주 | R5 매매 대상 |
| BRKU | 버크셔 2x | 방어주 | R5 매매 대상 |
| BABX | 알리바바 2x | 방어주 | R5 매매 대상 |
| SPY | S&P 500 ETF | 시장 지표 | R5 기준 |
| QQQ | 나스닥 100 ETF | 시장 지표 | R5 기준 |

---

*생성일: 2026-02-18 | 데이터: KIS 거래내역 953건 + 5분봉 백테스트 + evaluate_compliance.py 분석 결과*
