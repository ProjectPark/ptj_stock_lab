# PTJ v4 Baseline ì‹¬ì¸µ ë¶„ì„ ë¦¬í¬íŠ¸ (v2 â€” market_daily ë°˜ì˜)

> ìž‘ì„±ì¼: 2026-02-19
> ë°±í…ŒìŠ¤íŠ¸ ê¸°ê°„: 2025-02-18 ~ 2026-01-30 (240 ê±°ëž˜ì¼)
> ë°ì´í„°: `data/market/ohlcv/backtest_1min_v2.parquet` + `data/market/daily/market_daily.parquet`
>
> **v2 ì—…ë°ì´íŠ¸ ì‚¬ìœ **: ë°ì´í„° êµ¬ì¡° ë³€ê²½ ë°˜ì˜ â€” `market_daily.parquet` (yfinance ì¼ë´‰)ì„ SPY ì¼ë´‰ ì§€í‘œ ì†ŒìŠ¤ë¡œ êµì²´ í›„ ìž¬ì‹¤í–‰

---

## 0. v1 â†’ v2 ë³€ê²½ ì‚¬í•­ ìš”ì•½

| í•­ëª© | v1 (1ë¶„ë´‰ ì§‘ê³„) | v2 (market_daily ë°˜ì˜) | ë³€í™” |
|------|----------------|----------------------|------|
| **ìˆ˜ìµë¥ ** | +14.61% | **+25.74%** | +11.1%p â†‘ |
| **MDD** | -12.13% | **-9.34%** | 2.8%p ê°œì„  |
| **Sharpe** | 0.7434 | **1.3774** | +0.63 â†‘ |
| **Balanced Score** | +8.25 | **+23.73** | +15.5 â†‘ |
| CB ì°¨ë‹¨ | 2,057íšŒ | **1,644íšŒ** | -413íšŒ |
| ì‹¤í˜„ PnL | **-$1,141** | **+$3,860** | í‘ìž ì „í™˜ |
| swing_stage2 íšŸìˆ˜ | 1íšŒ | **2íšŒ** | +$4,601 ì¶”ê°€ |

**ê°œì„  ì›ì¸:** 1ë¶„ë´‰ ì§‘ê³„ SPY ì¼ë´‰ì´ ë¶€ì •í™•í–ˆë˜ ê²ƒì´ yfinance ì‹¤ì œ ì¼ë´‰ìœ¼ë¡œ êµì²´ë˜ì–´, íš¡ë³´ìž¥ ATR/RSI/EMA ì§€í‘œ ê³„ì‚°ì´ ì •í™•í•´ì§. ë”ë¶ˆì–´ IREN ëŒ€ì²´ ê°€ê²©ì´ market_dailyì—ì„œ ì§ì ‘ ì œê³µë¨.

---

## 1. í•µì‹¬ ì§€í‘œ ìš”ì•½

| ì§€í‘œ | v4 Baseline (v2) | v4 Baseline (v1) | v3 Baseline | v3 Best (ì°¸ê³ ) |
|------|-----------------|-----------------|-------------|---------------|
| **ì´ ìˆ˜ìµë¥ ** | **+25.74%** | +14.61% | -7.38% | +13.42% |
| **ì‹¤í˜„ PnL** | **+$3,860** | -$1,141 | â€” | â€” |
| MDD | -9.34% | -12.13% | -10.13% | -2.17% |
| Sharpe Ratio | 1.3774 | 0.7434 | -0.9150 | 2.3021 |
| ìŠ¹ë¥  | 40.4% | 39.8% | 57.5% | 43.0% |
| ë§¤ë„ íšŸìˆ˜ | **89íšŒ** | 88íšŒ | 2,255íšŒ | 804íšŒ |
| CB ì°¨ë‹¨ | **1,644íšŒ** | 2,057íšŒ | â€” | â€” |
| ìˆ˜ìˆ˜ë£Œ | $676 | $627 | 5,774,855ì› | 2,459,521ì› |

### Balanced Score (Phase 1 ëª©ì í•¨ìˆ˜ ê¸°ì¤€)

```
score = 25.74
      - 1.5 Ã— max(0, 9.34 - 8.0)       =  -2.01  (MDD íŽ˜ë„í‹°)
      - 0.8 Ã— max(0, 40.0 - 40.4)       =  +0.00  (ìŠ¹ë¥  íŒ¨ë„í‹° ì—†ìŒ)
      - 0.05 Ã— max(0, 80 - 89)          =  +0.00  (ê³¼ì†Œê±°ëž˜ ì—†ìŒ)
      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      Baseline Balanced Score            =  +23.73
```

> Phase 1 ìµœì í™” ëª©í‘œ: **Balanced Score > 30** (MDD â‰¤ 8% + Sharpe > 1.5 ë™ì‹œ ë‹¬ì„±)

---

## 2. ì‹¤í˜„ PnL ë¶„ì„ (v1 ëŒ€ë¹„ ê°œì„ )

| í•­ëª© | v2 (ìµœì‹ ) | v1 (ì´ì „) |
|------|-----------|-----------|
| ì´ˆê¸° ìžì‚° | $15,000.00 | $15,000.00 |
| ìµœì¢… ìžì‚° (equity curve) | **$18,860.35** | $17,192.07 |
| í‰ê°€ ìˆ˜ìµ | **+$3,860.35 (+25.74%)** | +$2,192.07 (+14.61%) |
| ì‹¤í˜„ PnL (ë§¤ë„ í•©ê³„) | **+$3,860.40** | -$1,141.21 |

v2ì—ì„œëŠ” **ì‹¤í˜„ PnLê³¼ equity curveê°€ ê±°ì˜ ì¼ì¹˜**(+$3,860.35 â‰ˆ +$3,860.40). ê¸°ê°„ ë§ ë¯¸ì²­ì‚° í¬ì§€ì…˜ì´ ì—†ì–´ ìˆ˜ìµë¥  ì‹ ë¢°ë„ê°€ ë†’ì•„ì¡Œë‹¤.

í•µì‹¬ ì›ì¸: swing_stage2_maturityê°€ 2íšŒ ë°œë™í•˜ì—¬ **+$5,836.66** ì´ìµì„ ì‹¤í˜„. ì´ëŠ” ì „ì²´ ìˆ˜ìµì˜ 151%ì— ë‹¬í•˜ë©°, v1ì˜ 1íšŒ ë°œë™(+$1,236.23) ëŒ€ë¹„ 4ë°° ì´ìƒì´ë‹¤.

---

## 3. ì‹œê·¸ë„ë³„ ì„±ê³¼ ì‹¬ì¸µ ë¶„ì„

| ì‹œê·¸ë„ | ë§¤ë„ | ìŠ¹ë¥  | ì´ PnL | í‰ê·  PnL | í‰ê°€ |
|--------|------|------|--------|----------|------|
| **twin** | 43íšŒ | **72.1%** | +$319.36 | +$7.43 | âœ… í•µì‹¬ ê°•ì  (v1 ëŒ€ë¹„ +$24 ê°œì„ ) |
| conditional_conl | 39íšŒ | **5.1%** | -$158.12 | -$4.06 | ðŸ”´ ì¹˜ëª…ì  ì•½ì  (v1ê³¼ ë™ì¼) |
| conditional_coin | 3íšŒ | 33.3% | +$52.77 | +$17.59 | âš ï¸ í‘œë³¸ ë¶€ì¡± |
| swing_stage1 | 2íšŒ | **0%** | -$2,190.27 | -$1,095.14 | ðŸ”´ ê³ ìœ„í—˜ (v1: -$2,567) |
| **swing_stage2** | **2íšŒ** | **100%** | **+$5,836.66** | **+$2,918.33** | âœ…âœ… í•µì‹¬ ì´ìµì› (v1: 1íšŒ +$1,236) |

### 3-1. swing_stage2 (âœ…âœ… í•µì‹¬ ì´ìµì› â€” 2íšŒ ë°œë™)

- v1ì—ì„œ 1íšŒ ë°œë™(+$1,236)ì—ì„œ v2ì—ì„œ 2íšŒ ë°œë™(+$5,837)ìœ¼ë¡œ ì¦ê°€
- ì›ì¸: market_daily ê¸°ë°˜ì˜ ì •í™•í•œ ATR/RSI ê³„ì‚°ìœ¼ë¡œ ìŠ¤ìœ™ ì‚¬ì´í´ì´ ì˜¬ë°”ë¥´ê²Œ ì™„ê²°ë¨
- **swing_stage2_maturity: 2íšŒ, 100% ìŠ¹ë¥ ** â€” ìŠ¤ìœ™ ì „ëžµì˜ í•µì‹¬ ì´ìµ ì—”ì§„
- ë‹¨, 2íšŒëŠ” ì—¬ì „ížˆ ì†Œí‘œë³¸. Phase 1ì—ì„œ ìž¬í˜„ ê°€ëŠ¥ì„± ê²€ì¦ í•„ìš”

### 3-2. swing_stage1 (ðŸ”´ ì†ì‹¤ ì¶•ì†Œëì§€ë§Œ ì—¬ì „ížˆ ìœ„í—˜)

- v1: 2íšŒ drawdown_stop â†’ -$2,567
- v2: 1íšŒ drawdown_stop(-$1,454) + 1íšŒ atr_stop(-$736) â†’ -$2,190
- ì†ì‹¤ ê·œëª¨ëŠ” ì¤„ì—ˆì§€ë§Œ ì—¬ì „ížˆ **ì „ì²´ ë§¤ë„ ì†ì‹¤ì˜ ì£¼ìš” ì›ì¸**
- `V4_SWING_STAGE1_DRAWDOWN_PCT = -15.0%` / `V4_SWING_TRIGGER_PCT = 15.0%` íŒŒë¼ë¯¸í„° ì¡°ì • ê²€í†  í•„ìš”

### 3-3. conditional_conl (ðŸ”´ ë¯¸í•´ê²° â€” ë™ì¼ ë¬¸ì œ ì§€ì†)

- 39íšŒ ì¤‘ 2ìŠ¹ 37íŒ¨ â€” v1ê³¼ ì™„ì „ížˆ ë™ì¼í•œ íŒ¨í„´
- market_daily ë³€ê²½ìœ¼ë¡œ ê°œì„ ë˜ì§€ ì•ŠìŒ â†’ **íŒŒë¼ë¯¸í„° ìžì²´ ë¬¸ì œ**
- ì›ì¸: `V4_CONL_TRIGGER_PCT = 4.5%` (ë‚®ì€ íŠ¸ë¦¬ê±°), `V4_CONL_ADX_MIN = 18.0` (ë‚®ì€ ADX ê¸°ì¤€)
- **Phase 1ì—ì„œ ë°˜ë“œì‹œ ADX/EMA/íŠ¸ë¦¬ê±° ê°•í™”ê°€ í•„ìš”**

---

## 4. ë§¤ë„ ì‚¬ìœ ë³„ ì„±ê³¼ ë¶„ì„

| ì‚¬ìœ  | íšŸìˆ˜ | ìŠ¹ë¥  | ì´ PnL | í‰ê·  PnL | ë¶„ì„ |
|------|------|------|--------|----------|------|
| carry_sell | 1íšŒ | 100% | +$35.63 | +$35.63 | ì†Œê·œëª¨ |
| coin_profit | 1íšŒ | 100% | +$67.68 | +$67.68 | ì†Œê·œëª¨ |
| conl_profit | 1íšŒ | 100% | +$26.52 | +$26.52 | ì†Œê·œëª¨ |
| eod_close | 4íšŒ | 0% | -$15.03 | -$3.76 | ì¢…ê°€ ê°•ì œì²­ì‚° |
| fixed_tp | 1íšŒ | 100% | +$87.21 | +$87.21 | ì •ìƒ |
| **staged_sell** | **65íšŒ** | **36.9%** | +$40.87 | +$0.63 | âš ï¸ ì €ìŠ¹ë¥  ëŒ€ëŸ‰ (ë¯¸ê°œì„ ) |
| stop_loss | 2íšŒ | 0% | -$127.27 | -$63.64 | v1(1íšŒ)ë³´ë‹¤ ì¦ê°€ |
| swing_stage1_drawdown_stop | 1íšŒ | 0% | -$1,454.18 | -$1,454.18 | ðŸ”´ ìµœëŒ€ ë‹¨ê±´ ì†ì‹¤ |
| swing_stage1_atr_stop | 1íšŒ | 0% | -$736.09 | -$736.09 | ðŸ”´ ì‹ ê·œ ATR ì†ì ˆ |
| **swing_stage2_maturity** | **2íšŒ** | **100%** | **+$5,836.66** | **+$2,918.33** | âœ…âœ… í•µì‹¬ ì´ìµì› |
| time_stop | 3íšŒ | 66.7% | +$18.14 | +$6.05 | v1(50%) ëŒ€ë¹„ ê°œì„  |
| twin_converge | 7íšŒ | 57.1% | +$80.26 | +$11.47 | âœ… ì–‘í˜¸ |

### staged_sell ì €ìŠ¹ë¥  ë¯¸í•´ê²°

- 65íšŒ / 36.9% ìŠ¹ë¥ ë¡œ v1ê³¼ ë™ì¼. market_daily ë³€ê²½ê³¼ ë¬´ê´€í•œ íŒŒë¼ë¯¸í„° ì´ìŠˆ
- `PAIR_GAP_SELL_THRESHOLD_V2 = 0.9%` â†’ v3 best(8.8%)ë¡œ ìƒí–¥ ì‹œ ê°œì„  ê¸°ëŒ€
- Phase 1 warm startì—ì„œ ìžë™ íƒìƒ‰ ì˜ˆì •

---

## 5. ë§¤ìˆ˜ ì°¨ë‹¨ ë¶„ì„

| ì°¨ë‹¨ ìœ í˜• | íšŸìˆ˜ | ë¹„ìœ¨ |
|-----------|------|------|
| CB ì°¨ë‹¨ (ì„œí‚·ë¸Œë ˆì´ì»¤) | **1,644íšŒ** | 47.6% |
| ì‹œê°„ì œí•œ ì°¨ë‹¨ (10:00 ET ì´í›„) | **1,811íšŒ** | 52.4% |
| íš¡ë³´ìž¥ ì°¨ë‹¨ | 0íšŒ | 0% |
| ì¼ì¼1íšŒ ì°¨ë‹¨ | 0íšŒ | 0% |
| **ì‹¤ì œ ë§¤ìˆ˜** | **21íšŒ** | â€” |

- CB ì°¨ë‹¨ì´ v1(2,057) â†’ v2(1,644)ë¡œ 413íšŒ ê°ì†Œ: market_daily ê¸°ë°˜ ATR/ì •í™•ë„ í–¥ìƒ íš¨ê³¼
- íš¡ë³´ìž¥ ê°ì§€ì¼ 37ì¼ì´ì§€ë§Œ ì°¨ë‹¨ì€ 0íšŒ â†’ ê°ì§€ëœ ë‚ ì—ë„ CB/ì‹œê°„ì œí•œì´ ì„ í–‰ ì°¨ë‹¨
- **í•µì‹¬ ë¬¸ì œ**: CB 1,644íšŒ ì—¬ì „ížˆ ê³¼ë„ (v3 best ëŒ€ë¹„ ê±°ëž˜ ê¸°íšŒ ê·¹ë„ë¡œ ì œí•œ)

---

## 6. ë°ì´í„° í™˜ê²½ ë° ì‹¤í–‰ ë…¸íŠ¸

| í•­ëª© | ë‚´ìš© |
|------|------|
| ë°±í…ŒìŠ¤íŠ¸ ê¸°ê°„ | 2025-02-18 ~ 2026-01-30 (240 ê±°ëž˜ì¼) |
| 1ë¶„ë´‰ ë°ì´í„° | 2025-01-03 ~ 2026-01-30 (269 ê±°ëž˜ì¼, 1,491,631 rows) |
| **market_daily** | **2025-02-03 ~ 2026-02-17 (8,352 rows, 32 ì¢…ëª©)** |
| Polymarket | 2024-02-01 ~ 2026-02-17 (748ì¼) |
| íš¡ë³´ìž¥ ê°ì§€ì¼ | 37ì¼ / 240ì¼ (15.4%, ì°¨ë‹¨ì€ 0íšŒ) |
| í†µí™” ë‹¨ìœ„ | USD (í•„ë“œëª… `_krw`ëŠ” í•˜ìœ„í˜¸í™˜ í‘œê¸°) |
| ì‹¤í–‰ í™˜ê²½ | pyenv ptj_stock_lab (Python 3.11.12) |
| ì‹¤í–‰ ì‹œê°„ | 16.8ì´ˆ |
| ë¦¬í¬íŠ¸ | `optimizers/docs/v4_baseline_report.md` |
| JSON | `data/results/baselines/v4_baseline_result.json` |

---

## 7. Phase 1 ìµœì í™” ìš°ì„  íƒìƒ‰ ë°©í–¥

### ìš°ì„ ìˆœìœ„ 1 â€” CB ìž„ê³„ê°’ ì™„í™” (Group C)

CB 1,644íšŒ ì—¬ì „ížˆ ê³¼ë„. ì „ì²´ ì°¨ë‹¨ì˜ 47.6%.

| íŒŒë¼ë¯¸í„° | í˜„ìž¬ê°’ | íƒìƒ‰ ë°©í–¥ |
|----------|--------|----------|
| `V4_CB_VIX_SPIKE_PCT` | 6.0% | **â†‘ 8~12%** |
| `V4_CB_VIX_COOLDOWN_DAYS` | 7ì¼ | **â†“ 3~5ì¼** |
| `V4_CB_GLD_SPIKE_PCT` | 3.0% | **â†‘ 4~6%** |
| `V4_CB_BTC_CRASH_PCT` | -5.0% | **â†“ -7~-10%** |
| `V4_CB_BTC_SURGE_PCT` | 5.0% | **â†‘ 7~10%** |

### ìš°ì„ ìˆœìœ„ 2 â€” CONL ì§„ìž… í•„í„° ê°•í™” (Group D)

conditional_conl 5.1% ìŠ¹ë¥ ì€ ì¦‰ì‹œ ê°œì„ í•´ì•¼ í•  ìˆ˜ì¤€.

| íŒŒë¼ë¯¸í„° | í˜„ìž¬ê°’ | íƒìƒ‰ ë°©í–¥ |
|----------|--------|----------|
| `V4_CONL_ADX_MIN` | 18.0 | **â†‘ 22~28** |
| `V4_CONL_EMA_SLOPE_MIN_PCT` | 0.0% | **â†‘ 0.1~0.3%** |
| `V4_CONL_TRIGGER_PCT` | 4.5% | **â†‘ 5.5~8% (v3 best=6.0)** |

### ìš°ì„ ìˆœìœ„ 3 â€” GAP / ë§¤ë„ ìž„ê³„ê°’ ìž¬ì„¤ì • (Group A)

v3 best warm start ì£¼ìž…ìœ¼ë¡œ Optunaê°€ ìžë™ íƒìƒ‰.

| íŒŒë¼ë¯¸í„° | í˜„ìž¬ê°’ | v3 Best | íƒìƒ‰ ë°©í–¥ |
|----------|--------|---------|----------|
| `V4_PAIR_GAP_ENTRY_THRESHOLD` | 2.2% | 7.6% | **â†‘ 7~10%** |
| `PAIR_GAP_SELL_THRESHOLD_V2` | 0.9% | 8.8% | **â†‘ 8~12%** |
| `STOP_LOSS_PCT` | -3.0% | -5.25% | **â†“ -5~-6%** |
| `COIN_SELL_PROFIT_PCT` | 3.0% | 5.0% | **â†‘ 4~6%** |

### ìš°ì„ ìˆœìœ„ 4 â€” íš¡ë³´ìž¥ ìž„ê³„ê°’ ì¡°ì • (Group B)

37ì¼ ê°ì§€ë˜ì—ˆìœ¼ë‚˜ 0íšŒ ì°¨ë‹¨. í˜„ìž¬ ìž„ê³„ê°’ì€ ë‚˜ì˜ì§€ ì•Šìœ¼ë‚˜ ì •ë°€ë„ í–¥ìƒ ì—¬ì§€ ìžˆìŒ.

---

## 8. ë‹¤ìŒ ë‹¨ê³„

```
í˜„ìž¬: Stage 1 ì™„ë£Œ âœ…  (Balanced Score = +23.73)
ì§„í–‰: Phase 1 â€” Wide Search
      400 trials / n_jobs=10 / objective=balanced / gap-max=12.0
```

```bash
pyenv shell ptj_stock_lab && python optimizers/optimize_v4_optuna.py \
  --stage 2 --n-trials 400 --n-jobs 10 \
  --objective balanced --gap-max 12.0 \
  --study-name ptj_v4_phase1 \
  --db sqlite:///data/optuna/optuna_v4_phase1.db
```

Phase 1 ì™„ë£Œ í›„ í™•ì¸ ì‚¬í•­:
- [ ] Balanced Score ìƒìœ„ 10ê°œ trialì—ì„œ CB ì°¨ë‹¨ 1,000íšŒ ì´í•˜ ë‹¬ì„± ì—¬ë¶€
- [ ] conditional_conl ìŠ¹ë¥  20% ì´ìƒ ë‹¬ì„± ì—¬ë¶€
- [ ] MDD â‰¤ 8% ë‹¬ì„± trial ì¡´ìž¬ ì—¬ë¶€ (í˜„ìž¬ baseline 9.34%)
- [ ] Sharpe > 1.5 ë‹¬ì„± ì—¬ë¶€ (í˜„ìž¬ baseline 1.38)
- [ ] Balanced Score > 30 ë‹¬ì„± trial ì¡´ìž¬ ì—¬ë¶€
