최상위 원칙 (전 모드 공통 / 절대 규칙)
0-1. 안전/거래 금지

데이터가 없거나(0/None/NaN), 오래됐으면(기본 2분 초과) → 신규 매수 금지(BUY_STOP) + 알람

현금이 없으면 매수 금지

신용/미수/대출/담보/대주 등 모든 레버리지성 신용 거래 절대 금지 (M20)

0-2. 주문 원칙

시장가 매수/매도 절대 금지 → LIMIT(지정가)만 허용 (M1)

체결(FILLED) 이후에만 Position/avg_price 갱신 (pending/partial에서 금지)

0-3. 우선순위(충돌 시 처리 순서)

M200 즉시매도(킬스위치)

M201 즉시모드(Polymarket 급변/전환)

리스크/이머전시 모드(재난 모드 등)

거래시간/휴장 캘린더 필터(M3)

비중 배분(T1~T4, M5)

일반 전략 신호 처리

즉시매도는 “랭킹/순서 변화”로 발동하지 않는다.
즉시매도는 M200 또는 M201 조건으로만 발동. (MASTER J 허가)

M0 — MTGA AI (시스템/서버/네트워크 점검 + 알람)
M0-1. 1순위 점검 항목

네트워크 연결/속도(브로커 왕복 레이턴시)

매수/매도 서버 상태

컴퓨터 상태: RAM/CPU/GPU 사용량

이상 시: 한국어로 “아기도 이해” 수준으로 상태 설명 + 알람

M0-2. 공휴일/휴장일 18:00 KST 재시작 규칙

KST 18:00 재시작 “요청”은 가능

단, 재시작 실행은 반드시 승인 필요

승인자: MASTER J(박태준) 또는 MASTER H(박태현)

승인 없으면 어떤 경우에도 재시작 금지

M0-3. 급등 감시/분석(보고)

레버리지 ETF가 +30% 이상 급등하면 자동 분석 + 알람

과거 2년 유사 패턴 탐색(오차범위 ±3%) 후 요약 보고(대상: MASTER J)

M1 — 지정가 ALL STOCK (시장가 완전 금지)

모든 매수/매도는 LIMIT ONLY

호가 제약(특히 KIS): 소수점/호가 단위 문제로 주문 거절이 나면

시장/종목별 TickSizeResolver로 정규화(ceil/floor)

실패 시 매수 금지 + 알람

미체결(pending) 관리: 만료/재시도 규칙 필요

기본: 5 bars 만료, 최대 3회 재시도

중복 주문 방지: Idempotency Key 필수

M2 — “즉시 행동” 정의

“즉시” = 조건이 True가 된 Bar 종료 시점에 주문 제출

지정가 기준 = 신호 Bar의 종가(close)

API 지연이 큰 경우: 신호 무효 + 알람(기본 1분 초과)

M3 — 거래시간 / 휴장 / DST (시간 게이트)

기본 거래 가능 시간: 17:30 ~ 06:00 KST (월~금)

US 시장 휴장/조기종료/서머타임(DST)은 캘린더로 처리

캘린더/휴장 여부가 불명확하거나 로드 실패 → 그 세션 거래 정지 + 알람

(참고) 2026 휴장: 기존 리스트 + Juneteenth(6/19) 포함

M4 — 리츠 리스크/모드 (VNQ + 한국 리츠 보조)
M4-0. 정정(중요)

“VNQ만으로 데이터 부족” → VNQ + (국내 리츠 보조 지표) 혼합 사용

탐욕지수는 전부 삭제

M4-1. 리츠 과열/조심 판단(단순화)

혼합 리츠 지표 = VNQ + (SK리츠/타이거리츠/롯데리츠) 변화율을 평균(데이터 없으면 UNKNOWN)

혼합지표 +1% 이상이면 → 조심모드

조심모드: 레버리지 신규 비중 50% 이하로 축소

M4-2. 리츠 과열 시 목표수익률 조정

“리츠 과열로 목표수익률 낮춤”은 제외항 명확화 반영

절대 목표수익률 하향 제외(절대 건드리지 말 것):

GLD/VIX/GDXU

CONZ/IREZ/HOOZ/MSTZ

SOXS/ETQ

리츠리스크 자체(모드)

그 외 조정이 필요하면 명시된 전략/종목만 적용

M5 — 매수 비중/카운터 (T1~T4)
M5-1. 동시 BUY 처리(필수)

같은 Bar에 BUY 신호 여러 개면 순차 실행 금지

반드시:

전체 BUY 신호 수집

우선순위(M200 점수 등)로 정렬

T1~T4 순차 배분

총합 검증(100% 초과 금지)

M5-2. T1~T4 순차 배분 규칙(남은 현금 기준)

T1: 55%

T2: 남은 현금의 40%

T3: 남은 현금의 33%

T4: 남은 현금 전액

5개 이상부터는 실매수 0, “예약 대기(@5~)”만 표시

M5-3. 비중 조절(중첩 합산)

GLD:

+1%마다 -0.1%p

-1%마다 +0.1%p

VIX:

+2%마다 -3%p

-2%마다 +1%p

USD(전일 대비):

상승: +0.1%p

하락: -0.2%p

여러 조건이 동시에 발생하면 전부 합산한다(중첩 적용)

M5-4. 공통 매수 금지

비중 조절 결과가 -1% 이하면 매수 금지

계산 결과가 100.1% 이상이면 매수 금지

현금 없으면 매수 금지

M6 — 최소 목표수익률 하한

모든 전략의 목표수익률(합산 후)이 계산된 뒤

최종 목표수익률을 “나누기 2” 적용

그 값이 0.8% 이하이면 → 어떤 조건이 성립해도 전부 매수 금지

(MASTER J 권한으로 강제)

M7 — 레버리지 금지 시 대체 종목

레버리지 사용 불가 시(예: 특정 모드에서 레버리지 stop):

SOXL → SOXX

ROBN → HOOD

FAS → XLF

Ertlx → XKE

Cure → XLV

TQQQ → QQQ

SOLT / ETHU → 금지

QUBX → QTUM

BITU → 매매 금지

NVDL → NVDA

SNXX / OKLL: 매수매도 제외

M20 — 신용/미수 금지 + 목표수익률 보정

어떤 경우에도 신용/미수/대출성 거래 금지

“수수료 제외 목표수익률”에는 +0.25%p를 추가(기본 보정)

M40 — Polymarket 확률 80% 이상 비중 상향(옵션)

BTC 80%+ : 지정된 BTC 관련 종목 비중 +15%p

NASDAQ 80%+ : 지정된 NASDAQ 관련 종목 비중 +15%p

BTC & NASDAQ 20% 이하 예측 : GDXU 비중 +20%p

(단, 상위 규칙 M200/M201/M6 등이 우선)

M28 — Polymarket 규격 v1.0 (핵심: “거래대금 Volume 기준 소스 자동선택”)
M28-1. BTC Primary 소스 자동선택(Volume Only) — “44POLYMARKET BTC 완전 삭제”

후보 마켓 2개:

A = bitcoin-price-on-<date>

B = bitcoin-above-on-<date>

각 마켓에서 파싱:

volume_usd (결정 기준)

activity_index = comments 수 (참고용/모니터링용, 결정에 사용 금지)

Primary 선택:

둘 다 성공 → volume_usd 큰 쪽

volume 차이가 ±1% 이내 → 직전 primary 유지, 없으면 A 고정

한쪽만 성공 → 성공한 쪽

둘 다 실패 → UNKNOWN + BUY_STOP + 알람

M28-2. BTC 확률 단일화

BTC_UP_PROB = Primary의 “상승 확률” 단일값(0~1)

BTC_DOWN_PROB = 1 - BTC_UP_PROB

확률 파싱 실패 → UNKNOWN + BUY_STOP

M28-3. BTC 51/49 포지션 게이트(조건부 허용 모드 제외)

BTC_UP_PROB ≥ 0.51 → LONG 허가 / SHORT 불허

BTC_UP_PROB ≤ 0.49 → SHORT 허가 / LONG 불허

0.49 < p < 0.51 → LONG/SHORT 모두 불허(중립)

NASDAQ(NDX) Polymarket 규격 (요청 반영)
NDX 입력 마켓

NDX 마켓(예시): ndx-up-or-down-on-<date>-2026 계열

출력 필드(반드시 기록):

NDX_UP_PROB

NDX_POLY_VOLUME_USD

NDX_ACTIVITY_INDEX(댓글 수 등) = “참고용”

NDX 51/49 포지션 게이트(조건부 허용 모드 제외)

NDX_UP_PROB ≥ 0.51 → LONG 허가 / SHORT 불허

NDX_UP_PROB ≤ 0.49 → SHORT 허가 / LONG 불허

0.49 < p < 0.51 → 둘 다 불허(중립)

M200 — 즉시 매도(킬스위치)
M200-0. 선언

즉시매도는 MASTER J(박태준) 허가된 최우선 기능

발동 시: 신규 매수 전부 무시, 매도만 실행

단, SCHD는 예외(매도 차단)

M200-1. 조건(1개라도 True면 즉시매도)

GLD +6% 이상

VIX +10% 이상

모든 주식 20일선 이탈

기한 만기: 익영업일 17:30~06:00 내 매도

리츠 지표 급등: 혼합 리츠 지표 +5% 이상

(기타 네가 정의한 급락/거래대금 조건은 “명확한 수치”로만 유지)

기존 “44POLYMARKET BTC”는 삭제 → 아래 M201로 대체(전환/급변)

M201 — 즉시모드(Polymarket 급변/전환) v1.0
M201-1. 입력값

p = BTC_UP_PROB (M28 Primary 기준 단일값)

p_prev = 직전 평가 시점 p

Δpp = (p - p_prev) * 100 (%p)

M201-2. 기본 진입 게이트(보유/신규 공통)

p ≥ 0.51: LONG 허가 / SHORT 불허

p ≤ 0.49: SHORT 허가 / LONG 불허

그 사이: 신규 진입 금지(현금)

M201-3. “보유 포지션” 즉시 전환/청산 규칙
(A) LONG 보유 중

아래 중 하나면 즉시 LONG 청산

p ≤ 0.45

Δpp ≤ -20 AND p ≤ 0.49 (예: 0.60→0.40)

청산 직후:

p ≤ 0.49 → 즉시 SHORT 전환(현금 전액)

중립이면 현금

(B) SHORT 보유 중

p ≥ 0.55 이면 즉시 SHORT 청산

청산 직후:

p ≥ 0.51 → 즉시 LONG 전환(현금 전액)

중립이면 현금

M201-4. 데이터 실패

p 또는 p_prev가 UNKNOWN이면:

M201 발동 금지

신규 진입 금지(BUY_STOP) + 알람

SCHD — MASTER 장기투자(절대 보호 자산)
SCHD-1. 매수 규칙(30일 실현손익 기준)

최근 30일(rolling 30 days) **실현손익(Realized PnL)**만 계산

실현손익 > 0일 때만 SCHD 매수

수익률 구간별 매수 금액(최대 50만원):

1% 이상: 10만원

2% 이상: 20만원

3% 이상: 30만원

4% 이상: 40만원

5% 이상: 50만원(상한)

SCHD-2. 매도 절대 금지(예외 1개)

M1/M3/M5/M7/M200/M201/모든 이머전시/리스크 모드에서도 SCHD 매도 불가

유일한 예외:

MASTER H 또는 MASTER J가 “AI 매매 기능을 완전히 OFF” 했을 때만 매도 허용