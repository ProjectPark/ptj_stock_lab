# D2S Attach v2 β€” Optuna μµμ ν™” μµμΆ… λ¦¬ν¬νΈ

> μ‘μ„±μΌ: 2026-02-25
> μ—”μ§„: `d2s_engine.py` + `params_d2s.py` β†’ `D2S_ENGINE_V3`
> κ·μΉ™ λ¬Έμ„: `docs/rules/line_c/trading_rules_attach_v2.md` (R1~R18)
> ν™•μ • νλΌλ―Έν„°: Job 104 (d2s_v3_r4_norobn) best #0 = baseline

---

## 1. νƒμƒ‰ νμ¤ν† λ¦¬

| μ„Έμ… | Study μ΄λ¦„ | κΈ°κ°„ | Trials | best IS | best OOS | λΉ„κ³  |
|---|---|---|---|---|---|---|
| μ΄μ „ | `d2s_v3_regime_optuna` | IS 25.03~25.09 / OOS 25.10~26.02 | 500 | +34.69% | +15.37% | ROBN ν¬ν•¨ 1λ…„ |
| μ΄μ „ | `d2s_v3_regime_no_robn` | IS 24.09~25.05 / OOS 25.06~26.02 | 500 | +33.68% | **+62.42%** | no-ROBN 1.5λ…„ (κµ¬ baseline) |
| μ΄λ² (r4) | `d2s_v3_r4_1y` (Job 103) | IS 25.03~25.09 / OOS 25.10~26.02 | 500 | +34.69% | +15.37% | ROBN ν¬ν•¨ 1λ…„ fresh |
| μ΄λ² (r4) | `d2s_v3_r4_norobn` (Job 104) | IS 24.09~25.05 / OOS 25.06~26.02 | 500 | +39.81% | **+64.27%** | **no-ROBN 1.5λ…„ fresh β†’ νλΌλ―Έν„° ν™•μ •** |

**Score ν•¨μ**: `IS_Shp Γ— 10.0 + OOS_Shp Γ— 20.0 - MDD Γ— 0.5`

---

## 2. νλΌλ―Έν„° ν™•μ • κ·Όκ±°

### 2-1. Job 103 (d2s_v3_r4_1y) β€” ROBN ν¬ν•¨ 1λ…„

| ν•­λ© | IS (25.03~25.09) | OOS (25.10~26.02) |
|---|---|---|
| Best Trial | #449 | β€” |
| Score | 65.49 | β€” |
| μμµλ¥  | +34.69% | +15.37% |
| MDD | -2.0% | -9.8% |
| Sharpe | 3.530 | 1.559 |

- Top 5 score λ²”μ„: 63.4 ~ 65.5 (μ•μ •μ  μλ ΄)
- **OOS +15.37%** β€” λ‹¨κΈ° IS κΈ°κ°„μΌλ΅ μΈν• κ³Όμ ν•© κ²½ν–¥

### 2-2. Job 104 (d2s_v3_r4_norobn) β€” no-ROBN 1.5λ…„ β… μ±„νƒ

| ν•­λ© | IS (24.09~25.05) | OOS (25.06~26.02) |
|---|---|---|
| Best Trial | **#0 (baseline)** | β€” |
| Score | 44.04 | β€” |
| μμµλ¥  | +39.81% | **+64.27%** |
| MDD | -9.2% | -14.7% |
| Sharpe | 1.886 | 1.489 |

- **500 trialsκ°€ baseline(#0)μ„ λ„μ§€ λ»ν•¨** β†’ νλΌλ―Έν„°κ°€ μ΄λ―Έ μλ ΄ μƒνƒ
- OOS +64.27% (μ΄μ „ +62.42% λ€λΉ„ +1.85%p κ°μ„ )

**μ±„νƒ μ΄μ **: OOS μ°μ›”μ„±(+64.27% vs +15.37%), νλΌλ―Έν„° μλ ΄ ν™•μΈ, λ” κΈ΄ κ²€μ¦ κΈ°κ°„(1.5λ…„)

---

## 3. ν™•μ • νλΌλ―Έν„° (D2S_ENGINE_V3)

### 3-1. λ μ§ κ°μ§€ νλΌλ―Έν„°

| νλΌλ―Έν„° | ν™•μ •κ°’ | λΉ„κ³  |
|---|---|---|
| `regime_bull_spy_streak` | **5** | SPY 5μΌ+ μ—°μ† μƒμΉ β†’ Bull |
| `regime_bear_spy_streak` | **1** | SPY 1μΌ μ—°μ† ν•λ½ β†’ Bear |
| `regime_spy_sma_period` | **12** | SMA 12μΌ κΈ°μ¤€ |
| `regime_spy_sma_bull_pct` | **1.1** | SPY > SMA+1.1% β†’ Bull ν™•μ‹  |
| `regime_spy_sma_bear_pct` | **-1.5** | SPY < SMA-1.5% β†’ Bear ν™•μ‹  |
| `regime_btc_bull_threshold` | **0.55** | BTC μƒμΉ ν™•λ¥  55%+ β†’ Bull |
| `regime_btc_bear_threshold` | **0.35** | BTC μƒμΉ ν™•λ¥  35%- β†’ Bear |

### 3-2. λ μ§ μ΅°κ±΄λ¶€ μ²­μ‚° (R20/R21)

| λ μ§ | take_profit | hold_days_max |
|---|---|---|
| Bull | **5.0%** | **12μΌ** |
| Bear/Neutral | **6.5%** | **8μΌ** |

> β οΈ **Optuna μ—­μ „ λ°κ²¬**: Bullμ—μ„ TP=5.9%κ°€ μ•„λ‹ 5.0%κ°€ μµμ  (λΉ λ¥Έ μµμ μ΄ Bull μμµ κ·Ήλ€ν™”)

### 3-3. μ§„μ… ν•„ν„° νλΌλ―Έν„°

| νλΌλ―Έν„° | ν™•μ •κ°’ | λΉ„κ³  |
|---|---|---|
| `bb_entry_hard_filter` | **True** | R19: BB hard filter ν™μ„±ν™” |
| `bb_entry_hard_max` | **0.30** | %B > 0.30 β†’ μ§„μ… κΈμ§€ |
| `bb_entry_max` | **0.40** | μ†ν”„νΈ μƒν• |
| `rsi_entry_min` | **37** | RSI 37~69 μ§„μ… ν—μ© |
| `rsi_entry_max` | **69** | |
| `rsi_danger_zone` | **76** | RSI > 76 β†’ μ°¨λ‹¨ |
| `contrarian_entry_threshold` | **-0.5** | μ—­μ¶”μ„Έ μ§„μ… κΈ°μ¤€ |
| `gap_bank_conl_max` | **5.0** | CONL κ°­μ—… μƒν• |
| `daily_new_entry_cap` | **0.15** | μΌμΌ μ‹ κ· μ§„μ… ν•λ„ 15% |

### 3-4. Market Score κ°€μ¤‘μΉ (μ •κ·ν™”)

| κ°€μ¤‘μΉ | ν™•μ •κ°’ | λΉ„κ³  |
|---|---|---|
| `w_gld` | **0.2273** | GLD (κΈ) |
| `w_spy` | **0.1364** | SPY (μ‹μ¥) |
| `w_riskoff` | **0.1818** | Risk-off μ‹ νΈ |
| `w_streak` | **0.1818** | SPY μ—°μ†μ„± |
| `w_vol` | **0.1818** | κ±°λλ‰ |
| `w_btc` | **0.0909** | BTC (Polymarket) |

### 3-5. V-bounce νλΌλ―Έν„° (R17)

| νλΌλ―Έν„° | ν™•μ •κ°’ |
|---|---|
| `vbounce_bb_threshold` | **0.20** (%B < 0.20) |
| `vbounce_crash_threshold` | **-12.0** (μΌκ°„ -12% μ΄ν•) |
| `vbounce_score_threshold` | **0.85** (score β‰¥ 0.85) |
| `vbounce_size_multiplier` | **2.5** (κΈ°λ³Έ μ‚¬μ΄μ¦ Γ— 2.5) |
| `vbounce_size_max` | **0.30** (μµλ€ 30%) |

### 3-6. μ΅°κΈ° μ†μ  νλΌλ―Έν„° (R18)

| νλΌλ―Έν„° | ν™•μ •κ°’ |
|---|---|
| `early_stoploss_days` | **2** (2μΌ μ΄λ‚΄ νλ³µ ν•„μ”) |
| `early_stoploss_recovery` | **3.0** (+3.0% λ―Έλ‹¬ μ‹ μ²­μ‚°) |

---

## 4. λ°±ν…μ¤νΈ μ„±κ³Ό (ν™•μ • νλΌλ―Έν„° κΈ°μ¤€)

### 4-1. no-ROBN (3μΆ…λ©: CONL/MSTU/AMDL)

| κµ¬κ°„ | κΈ°κ°„ | μμµλ¥  | MDD | Sharpe | μΉλ¥  |
|---|---|---|---|---|---|
| IS | 24.09.18 ~ 25.05.31 | +39.81% | -9.2% | 1.886 | β€” |
| OOS | 25.06.01 ~ 26.02.17 | **+64.27%** | -14.7% | 1.489 | β€” |
| **μ „μ²΄** | **24.09.18 ~ 26.02.17** | **+130.82%** | **-14.72%** | **1.542** | **79.7%** |

- μ΄ κ±°λ: 175κ±΄ (λ§¤μ 101 / λ§¤λ„ 74) | ν‰κ·  μμµλ¥ : +19.06% | PnL: +$20,647

### 4-2. ROBN ν¬ν•¨ (4μΆ…λ©: CONL/MSTU/AMDL/ROBN)

| κµ¬κ°„ | κΈ°κ°„ | μμµλ¥  | MDD | Sharpe | μΉλ¥  |
|---|---|---|---|---|---|
| **μ „μ²΄** | **25.02.03 ~ 26.02.17** | **+46.26%** | **-21.61%** | **1.668** | **80.7%** |

- ROBN μƒμ¥μΌ κΈ°μ¤€μΌλ΅ λ°μ΄ν„° μ‹μ‘ (market_daily.parquet λ²”μ„)
- μ΄ κ±°λ: 131κ±΄ | ν‰κ·  μμµλ¥ : +7.65% | PnL: +$7,643

### 4-3. μΆ…λ©λ³„ μ„±κ³Ό (ROBN ν¬ν•¨ κΈ°μ¤€)

| μΆ…λ© | μ²­μ‚°κ±΄ | μΉλ¥  | ν‰κ·  μμµλ¥  | PnL |
|---|---|---|---|---|
| AMDL | 9κ±΄ | 55.6% | +8.01% | +$1,381 |
| CONL | 21κ±΄ | 85.7% | +7.60% | +$2,293 |
| MSTU | 16κ±΄ | 81.2% | +8.88% | +$2,942 |
| ROBN | 11κ±΄ | 90.9% | +5.67% | +$1,026 |

---

## 5. κ·μΉ™λ³„ λ°λ™ ν†µκ³„

| κ·μΉ™ | no-ROBN μ „μ²΄ | ROBN ν¬ν•¨ | λΉ„κ³  |
|---|---|---|---|
| R17 V-bounce ν™•λ€ | 9ν | 6ν | λ°λ™ μ‹ ν¬μ§€μ… Γ— 2.5 |
| R18 μ΅°κΈ° μ†μ  | 10ν (μΉλ¥  30%) | 6ν (μΉλ¥  50%) | avg PnL -$367 / -$110 |
| R19 BB ν•λ“ μ°¨λ‹¨ | 5κ±΄ | **17κ±΄** | ROBN ν¬ν•¨ μ‹ μ°¨λ‹¨ λΉλ„β†‘ |

### λ μ§ λ¶„ν¬ (ROBN ν¬ν•¨ κΈ°μ¤€)

| λ μ§ | μΌμ | λΉ„μ¨ | μ²­μ‚°κ±΄ | avg PnL |
|---|---|---|---|---|
| Bull | 65μΌ | 25% | 7κ±΄ | +$7 |
| Bear | 117μΌ | **45%** | 31κ±΄ | +$8 |
| Neutral | 79μΌ | 30% | 19κ±΄ | +$7 |

> Bear λ μ§μ΄ 45%λ΅ κ°€μ¥ λ†’μ β€” 2025.09 μ΄ν›„ ν•λ½μ¥ λ°μ

---

## 6. ν•µμ‹¬ λ°κ²¬μ‚¬ν•­

### β‘  νλΌλ―Έν„° μλ ΄ ν™•μΈ
- 500 trials fresh νƒμƒ‰μ΄ baselineμ„ λ„μ§€ λ»ν•¨ (Job 104)
- D2S_ENGINE_V3 νλΌλ―Έν„°κ°€ ν„μ¬ νƒμƒ‰ κ³µκ°„ λ‚΄μ—μ„ **μ „μ—­ μµμ μ— μλ ΄**ν• κ²ƒμΌλ΅ νλ‹¨

### β‘΅ Bull TP μ—­μ „ (Optuna λ°κ²¬)
- μμƒ: Bullμ—μ„ λ†’μ€ TP(5.9%)κ°€ μ λ¦¬ β†’ μ‹¤μ : **5.0%κ°€ μµμ **
- ν•΄μ„: Bull λ μ§μ—μ„ λΉ λ¥Έ μµμ  + μ¬μ§„μ…μ΄ μ¥κΈ° λ³΄μ λ³΄λ‹¤ ν¨μ¨μ 

### β‘Ά ROBN ν¬ν•¨ μ‹ μ„±κ³Ό ν•λ½
- no-ROBN: +130.82% (1.5λ…„) vs ROBN ν¬ν•¨: +46.26% (1λ…„)
- μ§μ ‘ λΉ„κµλ” κΈ°κ°„ μ°¨μ΄λ΅ μ–΄λ µμ§€λ§, ROBNμ λ†’μ€ λ³€λ™μ„±μ΄ MDDλ¥Ό -21.6%λ΅ ν™•λ€
- R19 μ°¨λ‹¨ 17κ±΄ β†’ ROBN μ§„μ… μ‹λ„κ°€ λ§μΌλ‚ BB ν•„ν„°μ— μν•΄ λ‹¤μ μ°¨λ‹¨

### β‘£ μµκ·Ό Bear λ μ§ μ°μ„Έ (45%)
- Job 107 (RECENT_IS OOS: 2026-02) κ²°κ³Ό -1.74% β†’ ν„μ¬ νλΌλ―Έν„°κ°€ μµκ·Ό μ‹μ¥μ— μ•½ν•  μ μμ
- μ¶”κ°€ κ²€ν†  ν•„μ”

---

## 7. μ΄ν›„ κ¶μ¥ Study

### π”΄ μ°μ„ μμ„ 1 β€” μµκ·Ό μ‹μ¥ μ μ‘μ„± κ²€μ¦

**Study A: 2025.10 μ΄ν›„ Bear λ μ§ νλΌλ―Έν„° μ¬νƒμƒ‰**
- IS: 2025-09-01 ~ 2026-01-31 / OOS: 2026-02
- ν„μ¬ Bear λΉ„μ¨ 45% β†’ Bear νΉν™” TP/HD νλΌλ―Έν„° μ •λ°€ν™”
- Job 107 OOS -1.74% μ›μΈ λ¶„μ„ ν¬ν•¨

### π΅ μ°μ„ μμ„ 2 β€” λ μ§ κ°μ§€ μ •λ°€ν™”

**Study B: λ μ§ 3μ°¨μ› Ablation**
- SPY streak / SMA12 / BTC Polymarket κ°κ° μ κ±° ν›„ μ„±κ³Ό λΉ„κµ
- μ–΄λ μ°¨μ›μ΄ ν•µμ‹¬μΈμ§€, μ–΄λ μ°¨μ›μ΄ λ…Έμ΄μ¦μΈμ§€ ν™•μΈ

**Study C: BTC Polymarket λ°μ΄ν„° μ—†λ” ν™κ²½ κ°•κ±΄μ„± ν…μ¤νΈ**
- Polymarket λ°μ΄ν„° λ―Έμμ‹  μ‹ BITU ν΄λ°± ν’μ§ κ²€μ¦ (ν„μ¬ ν΄λ¬μ¤ν„°μ—μ„λ” μλ™ ν΄λ°±)

### πΆ μ°μ„ μμ„ 3 β€” κ·μΉ™ ν™•μ¥

**Study D: R17 V-bounce μ„κ³„κ°’ μ •λ°€ν™”**
- ν„μ¬ λ°λ™ λΉλ„κ°€ λ‚®μ (6~9ν / 1.5λ…„)
- crash κΈ°μ¤€(-12%) μ™„ν™” μ‹ λ°λ™ λΉλ„ vs ν’μ§ tradeoff λ¶„μ„

**Study E: AMDL μ „μ© μ§„μ… μ΅°κ±΄ κ°•ν™”**
- μΉλ¥  55.6%λ΅ 4μΆ…λ© μ¤‘ κ°€μ¥ λ‚®μ
- AMDL μ§„μ… μ΅°κ±΄ λ³„λ„ νλΌλ―Έν„°ν™” κ°€λ¥μ„± κ²€ν† 

---

## 8. κ²°λ΅ 

| ν•­λ© | κ²°κ³Ό |
|---|---|
| ν™•μ • νλΌλ―Έν„° | D2S_ENGINE_V3 (= Job 104 no-ROBN baseline) |
| κ²€μ¦ μ„±κ³Ό | OOS +64.27%, Full +130.82%, Sharpe 1.542, MDD -14.72% |
| νλΌλ―Έν„° μƒνƒ | μλ ΄ μ™„λ£ (500 trials μ¶”κ°€ νƒμƒ‰ λ¶ν•„μ”) |
| μ¦‰μ‹ κ³Όμ  | Study A (μµκ·Ό Bear λ μ§ μ μ‘) |
